<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiqin.mgs.order.api.dao.gift.GiftPoolDao">


    <!--插入赠品池赠品信息-->
    <insert id="add" parameterType="com.aiqin.mgs.order.api.domain.po.gift.GiftPool">
        insert into gift_pool
			(sku_code,
             sku_name,
             spu_code,
             spu_name,
             price_tax,
             manufacturer_guide_price,
             create_time,
             create_by,
             update_time,
             update_by)
		values
		    (#{skuCode},
             #{skuName},
             #{spuCode},
             #{spuName},
             #{priceTax},
             #{manufacturerGuidePrice},
             now(),
             #{createBy},
             now(),
             #{updateBy})
	</insert>

    <!--修改赠品状态-->
    <update id="updateUseStatus" parameterType="com.aiqin.mgs.order.api.domain.po.gift.GiftPool">
        update gift_pool
        <set>
            <if test="useStatus != null">
                use_status = #{useStatus,jdbcType=BIT},
            </if>
            update_time = now()
            where id = #{id,jdbcType=VARCHAR}
        </set>
    </update>

    <!--查询赠品池列表-->
     <select id="getGiftPoolList" resultType="com.aiqin.mgs.order.api.domain.po.gift.GiftPool"
             parameterType="com.aiqin.mgs.order.api.domain.po.gift.GiftPool">
        SELECT
              id,
              sku_code AS skuCode,
              sku_name AS skuName,
              spu_code AS spuCode,
              spu_name AS spuName,
              price_tax AS priceTax,
              manufacturer_guide_price AS manufacturerGuidePrice,
              use_status AS useStatus,
              create_time AS createTime,
              update_time AS updateTime,
              create_by AS createBy,
              update_by AS updateBy
          FROM
              gift_pool where 1 = 1
          <if test="skuCode != null and skuCode != ''">
              and sku_code = #{skuCode}
          </if>
          <if test="skuName != null and skuName != ''">
              and sku_name = #{skuName}
          </if>
         <if test="pageSize != null and pageSize != ''">
             limit #{beginIndex,jdbcType=INTEGER}, #{pageSize,jdbcType=INTEGER}
          </if>
     </select>

     <!--查询赠品池列表总数-->
     <select id="getTotalNum" resultType="java.lang.Integer" parameterType="com.aiqin.mgs.order.api.domain.po.gift.GiftPool">
          SELECT
            count(0)
          FROM
          gift_pool where 1 = 1
          <if test="skuCode != null and skuCode != ''">
               and sku_code = #{skuCode}
          </if>
          <if test="skuName != null and skuName != ''">
               and sku_name = #{skuName}
          </if>
     </select>

    <!--通过仓库code List 查询门店拥有权限的赠品池数据-->
    <select id="getGiftPoolListByWarehouseCodeList" resultType="com.aiqin.mgs.order.api.domain.po.gift.GiftPool"
            parameterType="com.aiqin.mgs.order.api.domain.po.gift.GiftPool">
        SELECT
        g.id,
        g.sku_code AS skuCode,
        g.sku_name AS skuName,
        g.spu_code AS spuCode,
        g.spu_name AS spuName,
        g.price_tax AS priceTax,
        g.manufacturer_guide_price AS manufacturerGuidePrice,
        g.use_status AS useStatus,
        g.create_time AS createTime,
        g.update_time AS updateTime,
        g.create_by AS createBy,
        g.update_by AS updateBy
        FROM
        gift_pool g left join complimentary_warehouse_correspondence c on g.sku_code = c.sku_code  where 1 = 1
        <if test="skuCode != null and skuCode != ''">
            and g.sku_code = #{skuCode}
        </if>
        <if test="skuName != null and skuName != ''">
            and g.sku_name = #{skuName}
        </if>
        <if test="warehouseCodeList != null and warehouseCodeList.size > 0">
            and c.warehouse_code in
            <foreach collection="warehouseCodeList" item="item" open="( 'all'," separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="pageSize != null and pageSize != ''">
            limit #{beginIndex,jdbcType=INTEGER}, #{pageSize,jdbcType=INTEGER}
        </if>
    </select>

    <!--查询赠品池列表总数-->
    <select id="getTotalNumByWarehouseCodeList" resultType="java.lang.Integer" parameterType="com.aiqin.mgs.order.api.domain.po.gift.GiftPool">
        SELECT
        count(0)
        FROM
        gift_pool g left join complimentary_warehouse_correspondence c on g.sku_code = c.sku_code  where 1 = 1
        <if test="skuCode != null and skuCode != ''">
            and g.sku_code = #{skuCode}
        </if>
        <if test="skuName != null and skuName != ''">
            and g.sku_name = #{skuName}
        </if>
        <if test="warehouseCodeList != null and warehouseCodeList.size > 0">
            and c.warehouse_code in
            <foreach collection="warehouseCodeList" item="item" open="( 'all'," separator="," close=")">
                #{item}
            </foreach>
        </if>
    </select>

</mapper>
