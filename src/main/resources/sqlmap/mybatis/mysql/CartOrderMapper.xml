<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.aiqin.mgs.order.api.dao.CartOrderDao">
    <resultMap id="CartOrderInfoMapping" type="com.aiqin.mgs.order.api.domain.CartOrderInfo">
        <result column="product_id" jdbcType="VARCHAR" property="productId"/>
        <result column="cart_order_id" jdbcType="VARCHAR" property="cartOrderId"/>
        <result column="franchisee_id" jdbcType="VARCHAR" property="franchiseeId"/>
        <result column="distributor_id" jdbcType="VARCHAR" property="distributorId"/>
        <result column="sku_id" jdbcType="VARCHAR" property="skuId"/>
        <result column="spu_id" jdbcType="VARCHAR" property="spuId"/>
        <result column="product_name" jdbcType="VARCHAR" property="productName"/>
        <result column="amount" jdbcType="INTEGER" property="amount"/>
        <result column="logo" jdbcType="VARCHAR" property="logo"/>
        <result column="price" jdbcType="DECIMAL" property="price"/>
        <result column="color" jdbcType="VARCHAR" property="color"/>
        <result column="product_size" jdbcType="VARCHAR" property="productSize"/>
        <result column="activity_id" jdbcType="VARCHAR" property="activityId"/>
        <result column="activity_name" jdbcType="VARCHAR" property="activityName"/>
        <result column="distribution_type" jdbcType="INTEGER" property="distributionType"/>
    </resultMap>

    <sql id="Base">
        product_id,cart_order_id,franchisee_id,sku_id,spu_id,product_name,amount,logo,price,color,product_size,activity_id,
        activity_name,create_time,update_time
    </sql>

    <!-- 将商品添加添加购物车 -->
    <insert id="insertCart" parameterType="com.aiqin.mgs.order.api.domain.CartOrderInfo">
        insert into order_store_cart
			(product_id,cart_order_id,product_name,amount,logo,create_time,update_time,price,color,product_size,activity_id,activity_name,distribution_type,sku_id,spu_id,distributor_id)
		values
		    (#{productId},#{cartOrderId},#{productName},#{amount},#{logo},CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,#{price},#{color},#{productSize},#{activityId},#{activityName},#{distributionType},#{skuId},#{spuId},#{distributorId})
    </insert>

    <!-- 判断SKU商品是否已存在购物车中 -->
    <select id="isYesCart"  resultType="java.lang.String" parameterType="com.aiqin.mgs.order.api.domain.CartInfo">
         select SUM(amount) as amount from order_store_cart where 1=1
         and distributor_id =#{distributorId}
         and product_id = #{productId}
         and sku_id = #{skuId}
         GROUP BY distributor_id,product_id,sku_id
    </select>

    <!-- 更新购物车 -->
    <update id="updateCartById" parameterType="com.aiqin.mgs.order.api.domain.CartInfo">
        update order_store_cart set amount=#{amount} where 1=1
        and distributor_id = #{distributorId}
        and product_id = #{productId}
        and sku_id = #{skuId}
    </update>



</mapper>
